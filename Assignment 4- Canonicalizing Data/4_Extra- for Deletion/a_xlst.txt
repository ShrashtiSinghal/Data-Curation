<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <xsl:variable name="smallcase" select="'abcdefghijklmnopqrstuvwxyz'"/>
  <xsl:variable name="uppercase" select="'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"/>

  <xsl:template match="/">
    <consumerComplaints>
      <xsl:for-each select="consumerComplaints/complaint">
        <xsl:variable name="complaint-id" select="@id"/>
        <complaint id="{$complaint-id}">
          <events>
            <xsl:for-each select="event">
              <event>
                <type>
                  <xsl:value-of select="@type"/>
                </type>
                <date>
                  <xsl:value-of select="@date"/>
                </date>
              </event>
            </xsl:for-each>
          </events>
          <product>
            <productType>
              <xsl:value-of select="product/productType"/>
            </productType>
            <subproduct>
              <xsl:value-of select="product/subproduct"/>
            </subproduct>
          </product>
          <issue>
            <issueType>
              <xsl:value-of select="issue/issueType"/>
            </issueType>
          </issue>
          <consumerNarrative>
            <xsl:value-of select="normalize-space(consumerNarrative)"/>
          </consumerNarrative>
          <company>
            <companyName>
              <xsl:value-of select="company/companyName"/>
            </companyName>
            <companyState>
              <xsl:value-of select="company/companyState"/>
            </companyState>
            <companyZip>
              <xsl:value-of select="company/companyZip"/>
            </companyZip>
          </company>
          <submitted>
            <via>
              <xsl:value-of select="submitted/@via"/>
            </via>
          </submitted>
          <response>
            <timely>
              <xsl:variable name="response-timely" select="response/@timely"/>
              <xsl:choose>
                <xsl:when
                  test="translate($response-timely, $uppercase, $smallcase) = 'y'">yes</xsl:when>
                <xsl:otherwise>no</xsl:otherwise>
              </xsl:choose>
            </timely>
            <consumerDisputed>
              <xsl:variable name="response-disputed"
                            select="response/@consumerDisputed"/>
              <xsl:choose>
                <xsl:when
                  test="translate($response-disputed, $uppercase, $smallcase) = 'y'">yes</xsl:when>
                <xsl:otherwise>no</xsl:otherwise>
              </xsl:choose>
            </consumerDisputed>
            <responseType>
              <xsl:value-of select="response/responseType"/>
            </responseType>
          </response>
        </complaint>
      </xsl:for-each>
    </consumerComplaints>
  </xsl:template>
</xsl:stylesheet>
